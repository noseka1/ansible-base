apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: acme-azure
  namespace: {{ certman_instance_namespace }}
spec:
  acme:
    server: {{ certman_acme_server }}
    email: {{ certman_acme_azure_acme_email }}
    privateKeySecretRef:
      name: acme-azure-account-private-key
    solvers:
    - selector: {}
      dns01:
        azureDNS:
          clientID: '{{ certman_azure_credentials.resources.0.data.azure_client_id | b64decode }}'
          clientSecretSecretRef:
            name: acme-azure-credentials
            key: azure_client_secret
          subscriptionID: '{{ certman_azure_credentials.resources.0.data.azure_subscription_id | b64decode }}'
          tenantID: '{{ certman_azure_credentials.resources.0.data.azure_tenant_id | b64decode }}'
          resourceGroupName: '{{ certman_acme_azure_resource_group_name }}'
          hostedZoneName: '{{ certman_acme_azure_hosted_zone_name }}'
          environment: AzurePublicCloud
