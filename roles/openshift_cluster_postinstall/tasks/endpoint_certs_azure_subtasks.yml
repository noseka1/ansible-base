- name: Retrieve AWS DNS zone id
  kubernetes.core.k8s_info:
    api_version: config.openshift.io/v1
    kind: DNS
    name: cluster
  register: openshift_cluster_postinstall_cluster_dns

- import_role:
    name: openshift_cert_manager
    tasks_from: direct_deploy.yml

- import_role:
    name: openshift_cert_manager
    tasks_from: issuer_acme_azure_direct_deploy.yml
  vars:
    certman_acme_server: https://acme-v02.api.letsencrypt.org/directory
    certman_acme_azure_resource_group_name: '{{ (openshift_cluster_postinstall_cluster_dns.resources.0.spec.publicZone.id | split("/"))[4] }}'
    certman_acme_azure_hosted_zone_name: '{{ (openshift_cluster_postinstall_cluster_dns.resources.0.spec.publicZone.id | split("/"))[8] }}'
    certman_certificate_dns_name: 'mytest.{{ openshift_common_cluster_domain }}'

- import_tasks: endpoint_certs_complete.yml
  vars:
    openshift_cluster_postinstall_cert_issuer_name: acme-azure
