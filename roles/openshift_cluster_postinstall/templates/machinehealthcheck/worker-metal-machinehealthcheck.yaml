# This configuration is based on the settings used in ROSA clusters
apiVersion: machine.openshift.io/v1beta1
kind: MachineHealthCheck
metadata:
  # Enable power-cycle remediation. With this remediation strategy, unhealthy hosts are rebooted instead of removed from the cluster.
  # See also https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html/machine_management/deploying-machine-health-checks#mgmt-power-remediation-baremetal-about-creating-mhc-baremetal_deploying-machine-health-checks
  annotations:
    machine.openshift.io/remediation-strategy: external-baremetal
  name: worker-metal
  namespace: openshift-machine-api
spec:
  maxUnhealthy: 40%
  nodeStartupTimeout: 40m
  selector:
    matchExpressions:
    - key: machine.openshift.io/cluster-api-machine-role
      operator: NotIn
      values:
      - infra
      - master
    - key: machine.openshift.io/cluster-api-machineset
      operator: Exists
    - key: machine.openshift.io/instance-type
      operator: In
      values:
      - m5.metal
      - m5d.metal
      - m5n.metal
      - m5dn.metal
      - m5zn.metal
      - m6a.metal
      - m6i.metal
      - m6id.metal
      - r5.metal
      - r5d.metal
      - r5n.metal
      - r5dn.metal
      - r6a.metal
      - r6i.metal
      - r6id.metal
      - x2iezn.metal
      - z1d.metal
      - c5.metal
      - c5d.metal
      - c5n.metal
      - c6a.metal
      - c6i.metal
      - c6id.metal
      - i3.metal
      - i3en.metal
  unhealthyConditions:
  - status: 'False'
    timeout: 8m
    type: Ready
  - status: Unknown
    timeout: 15m
    type: Ready
