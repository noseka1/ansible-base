- name: Retrieve an admin token
  community.hashi_vault.vault_token_create:
    url: '{{ hvault_addr }}'
    validate_certs: '{{ not hvault_skip_verify }}'
    auth_method: userpass
    username: admin
    password: '{{ generic_user_password }}'
    display_name: admin
    policies: admin
  changed_when: false
  register: hvault_token_result
  when: hvault_token is not defined

- name: Save vault admin token
  set_fact:
    hvault_token: '{{ hvault_token_result.login.auth.client_token }}'
  when: hvault_token is not defined
