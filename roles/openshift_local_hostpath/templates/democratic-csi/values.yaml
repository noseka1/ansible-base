csiDriver:
  # Should be globally unique for a given cluster
  name: org.democratic-csi.local-hostpath
  attachRequired: false
  # Disable storage capacity reporting to allow overprovisioning
  storageCapacity: false
  fsGroupPolicy: File

controller:
  enabled: true
  strategy: node
  externalProvisioner:
    # For available options refer to:
    # https://github.com/kubernetes-csi/external-provisioner?tab=readme-ov-file#command-line-options
    extraArgs:
      - --leader-election=false
      - --node-deployment=true
      - --node-deployment-immediate-binding=false
      - --feature-gates=Topology=true
      - --strict-topology=true
      - --enable-capacity=true
      - --capacity-ownerref-level=1

  externalAttacher:
    enabled: false

  externalResizer:
    enabled: false

  externalSnapshotter:
    enabled: true
    extraArgs:
      - --leader-election=false
      - --node-deployment=true

  driver:
    image:
      registry: docker.io/democraticcsi/democratic-csi
      tag: '{{ localhostpath_democratic_csi_image_tag }}'
    securityContext:
      privileged: true
  rbac:
    openshift:
      # Set to true if running on OpenShift
      privileged: true

node:
  driver:
    extraVolumeMounts:
      - name: local-storage
        mountPath: {{ localhostpath_host_path }}
        mountPropagation: Bidirectional
    image:
      registry: docker.io/democraticcsi/democratic-csi
      tag: '{{ localhostpath_democratic_csi_image_tag }}'
    # Allowed values are info, debug
    logLevel: info
  extraVolumes:
    - name: local-storage
      hostPath:
        path: {{ localhostpath_host_path }}
        type: DirectoryOrCreate
  rbac:
    openshift:
      # Set to true if running on OpenShift
      privileged: true

storageClasses:
  - name: local-hostpath
    annotations:
      storageclass.kubernetes.io/is-default-class: >-
        {{ (not oscommon_default_storage_class or oscommon_default_storage_class == 'local-hostpath') | to_json }}
    reclaimPolicy: Delete
    volumeBindingMode: WaitForFirstConsumer
    allowVolumeExpansion: false

volumeSnapshotClasses:
  - name: local-hostpath
    annotations:
      snapshot.storage.kubernetes.io/is-default-class: >-
        {{ (not oscommon_default_volume_snapshot_class or oscommon_default_volume_snapshot_class == 'local-hostpath') | to_json }}

driver:
  config:
    driver: local-hostpath
    service:
      controller:
        capabilities:
          rpc:
            - CREATE_DELETE_VOLUME
            - CREATE_DELETE_SNAPSHOT
            - CLONE_VOLUME
            - SINGLE_NODE_MULTI_WRITER
            # Disable storage capacity reporting to allow overprovisioning
            #- GET_CAPACITY
    local-hostpath:
      shareBasePath: {{ localhostpath_host_path }}
      controllerBasePath: {{ localhostpath_host_path }}
      dirPermissionsMode: "0777"
      dirPermissionsUser: 0
      dirPermissionsGroup: 0
      snapshots:
        default_driver: filecopy
