- name: Enable wildcard DNS routes
  kubernetes.core.k8s:
    template:
      - kubevirt/prereqs/default-ingresscontroller.yaml

- name: Create namespace for hosted cluster configuration
  kubernetes.core.k8s:
    template:
      - kubevirt/prereqs/hosted-clusters-ns.yaml

- import_role:
    name: openshift_autogitops
    tasks_from: app_deploy.yml
  vars:
    autogitops_app_src_path: templates/kubevirt/instance
    autogitops_app_dst_path: hosted-cluster/kubevirt
    autogitops_app_namespace: hosted-clusters

- debug:
    msg: |
      Cluster {{ multicluster_engine_hosted_cluster_kubevirt.cluster_name }} deployed successfully.
      You can download the admin kubeconfig by issuing 'oc extract -n hosted-clusters secret/{{ hostedcluster_result.resources.0.status.kubeconfig.name }}'
      You can display the kubeadmin password by issuing 'oc extract -n hosted-clusters secret/{{ hostedcluster_result.resources.0.status.kubeadminPassword.name }} --to -'
