- name: Retrieve all CRDs
  kubernetes.core.k8s_info:
    api_version: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
  register: mcemanagedcluster_crd_result

- set_fact:
    rhacm_detected: >-
      {{ mcemanagedcluster_crd_result.resources
          | json_query("[?spec.group=='agent.open-cluster-management.io' && spec.names.kind=='KlusterletAddonConfig']") | length == 1 }}
