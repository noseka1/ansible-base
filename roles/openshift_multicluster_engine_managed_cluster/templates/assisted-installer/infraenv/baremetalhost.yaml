---
{% for key, value in multicluster_engine_managed_cluster_baremetal.cluster_nodes.items() %}
{% if value.bmh is defined %}
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: {{ key }}
  namespace: {{ multicluster_engine_managed_cluster.cluster_name }}-infraenv
  labels:
    infraenvs.agent-install.openshift.io: {{ multicluster_engine_managed_cluster.cluster_name }}
spec:
  online: true
  automatedCleaningMode: disabled
  bootMACAddress: '{{ value.bmh.boot_macaddr }}'
  bmc:
    address: '{{ value.bmh.bmc.address }}'
    credentialsName: bmc-{{ key | regex_replace(':', '-',) }}
    disableCertificateVerification: {{ value.bmh.bmc.disable_certificate_verification }}
  bootMode: '{{ value.bmh.boot_mode }}'
  rootDeviceHints: {{ value.bmh.root_device_hints | to_json }}
{% endif %}
{% endfor %}
