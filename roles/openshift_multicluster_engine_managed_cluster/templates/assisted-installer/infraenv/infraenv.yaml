apiVersion: agent-install.openshift.io/v1beta1
kind: InfraEnv
metadata:
  name: {{ mcemanagedcluster_info.cluster_name }}
  namespace: {{ mcemanagedcluster_info.cluster_name }}-infraenv
  labels:
    agentclusterinstalls.extensions.hive.openshift.io/location: '{{ mcemanagedcluster_info.location }}'
    networkType: {{ mcemanagedcluster_info.network_type }}
spec:
{% if mcemanagedcluster_info.ntp_sources | default([]) %}
  additionalNTPSources: {{ mcemanagedcluster_info.ntp_sources | to_yaml }}
{% endif %}
{% if mcemanagedcluster_info.trusted_ca_bundle is defined and
      mcemanagedcluster_info.trusted_ca_bundle %}
  additionalTrustBundle: |
    {{ mcemanagedcluster_info.trusted_ca_bundle | indent(4) }}
{% endif %}
  agentLabels:
    agentclusterinstalls.extensions.hive.openshift.io/location: '{{ mcemanagedcluster_info.location }}'
  pullSecretRef:
    name: {{ mcemanagedcluster_info.cluster_name }}-pull-secret
{% if mcemanagedcluster_info.ssh_authorized_key | length > 0 %}
  sshAuthorizedKey: '{{ mcemanagedcluster_info.ssh_authorized_key }}'
{% endif %}
  nmStateConfigLabelSelector:
    matchLabels:
      infraenvs.agent-install.openshift.io: {{ mcemanagedcluster_info.cluster_name }}
{% if mcemanagedcluster_info.clusterwide_proxy is defined and
      mcemanagedcluster_info.clusterwide_proxy %}
  proxy:
    httpProxy: {{ mcemanagedcluster_info.clusterwide_proxy.http_proxy }}
    httpsProxy: {{ mcemanagedcluster_info.clusterwide_proxy.https_proxy }}
    noProxy: {{ mcemanagedcluster_info.clusterwide_proxy.no_proxy }}
{% else %}
  proxy: {}
{% endif %}
  cpuArchitecture: {{ mcemanagedcluster_info.cpu_architecture }}
