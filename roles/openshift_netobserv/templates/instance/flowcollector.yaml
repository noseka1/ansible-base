# See the following links for configuration options:
# https://docs.openshift.com/container-platform/4.17/observability/network_observability/configuring-operator.html
# https://github.com/netobserv/network-observability-operator/blob/release-1.7/config/samples/flows_v1beta2_flowcollector.yaml
apiVersion: flows.netobserv.io/v1beta2
kind: FlowCollector
metadata:
  name: cluster
spec:
  namespace: netobserv
  deploymentModel: Direct
  agent:
    type: eBPF
    ebpf:
      features:
      - DNSTracking
      - FlowRTT
      - PacketDrop
      sampling: 50
      logLevel: info
      # Privileged mode is required for features:
      # DNSTracking
      # PacketDrop
      privileged: true
      resources:
        limits:
          memory: 800Mi
        requests:
          cpu: 100m
          memory: 50Mi
  processor:
    # Enrich network flow data with the topology.kubernetes.io/zone
    # label value applied to the nodes
    addZone: true
    logLevel: info
    resources:
      limits:
        memory: 800Mi
      requests:
        cpu: 100m
        memory: 100Mi
    # logTypes defines the desired record types to generate. Possible values are:
    # * Flows (default) to export regular network flows
    # * Conversations to generate events for started conversations, ended conversations
    #   as well as periodic "tick" updates
    # * EndedConversations to generate only ended conversations events
    # * All to generate both network flows and all conversations events
    logTypes: All
    advanced:
      conversationEndTimeout: 10s
      conversationHeartbeatInterval: 30s
  loki:
    mode: LokiStack
    lokiStack:
      namespace: netobserv-loki
      name: loki
  consolePlugin:
    enable: true
    logLevel: info
    portNaming:
      enable: true
      portNames:
        "3100": loki
    quickFilters:
    - default: true
      filter:
        flow_layer: '"app"'
      name: Applications
    - filter:
        flow_layer: '"infra"'
      name: Infrastructure
    - default: true
      filter:
        dst_kind: '"Pod"'
        src_kind: '"Pod"'
      name: Pods network
    - filter:
        dst_kind: '"Service"'
      name: Services network
