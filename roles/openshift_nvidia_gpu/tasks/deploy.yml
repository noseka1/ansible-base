- name: Configure PCI passthrough for GPU nodes
  kubernetes.core.k8s:
    template:
      - passthrough/81-gpu-vfio-mc.yaml
      - passthrough/gpu-mcp.yaml

- name: Deploy GPU nodes MachineSet
  import_role:
    name: openshift_common
    tasks_from: machineset_deploy.yml
  vars:
    oscommon_add_machineset_role: gpu
    oscommon_add_machineset_instance_type: '{{ ngpu_instance_type }}'
    oscommon_add_machineset_availability_zones: '{{ ngpu_availability_zones }}'
    oscommon_add_machineset_nodes_per_zone: '{{ ngpu_nodes_per_zone }}'
    oscommon_add_machineset_labels:
      node-role.kubernetes.io/gpu: ""
    oscommon_add_machineset_taints:
      - effect: NoSchedule
        key: node-role.kubernetes.io/gpu
