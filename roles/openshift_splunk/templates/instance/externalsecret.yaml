apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: splunk-{{ splunk_instance_name }}-secret
  namespace: {{ splunk_instance_namespace }}
spec:
  secretStoreRef:
    name: autogitops
    kind: ClusterSecretStore
  dataFrom:
  - extract:
      conversionStrategy: Default
      decodingStrategy: None
      metadataPolicy: None
      key: '{{ oscommon_cluster_domain }}/splunk/instance/credentials'
  # Splunk modifies the secret by adding further credentials to the secret. The default
  # creationPolicy = Owner removes the Splunk updates from the secret.
  target:
    creationPolicy: Merge
